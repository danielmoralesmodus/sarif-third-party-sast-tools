# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: tfsec

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  schedule:
    - cron: '27 8 * * 5'

jobs:
  tfsec:
    name: Run tfsec sarif report
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    steps:
      - name: Clone repo
        uses: actions/checkout@v4

      - name: Run tfsec (print to console and create SARIF)
        uses: aquasecurity/tfsec-action@v1.0.0
        with:
          # This command tells tfsec to use two formats:
          # 1. 'lovely': Prints the human-readable results to the console.
          # 2. 'sarif': Outputs a SARIF file.
          # The '--out tfsec' part sets the base filename.
          # tfsec will automatically create 'tfsec.sarif' from this.
          additional_args: "--format lovely,sarif --out tfsec"

      - name: Upload SARIF file
        uses: github/codeql-action/upload-sarif@v3
        with:
          # This step finds the 'tfsec.sarif' file created above
          sarif_file: tfsec.sarif
